# KOSPI200 Daily History Batch

KOSPI200 종목에 대한 일봉 히스토리 데이터를 안전하게 수집하는 배치 시스템입니다.

## 🎯 주요 기능

- **정확한 KOSPI200 종목 식별**: CpCodeMgr API로 실시간 KOSPI200 종목 확인
- **불규칙한 대기시간**: 12-60초 사이 랜덤 대기로 서버 부하 방지
- **증분 업데이트**: 기존 데이터가 있으면 최근 데이터만 수집
- **안전한 에러 처리**: 개별 종목 실패 시에도 전체 작업 계속
- **상세한 진행 상황**: 실시간 진행률과 통계 제공

## 🚀 사용법

### 기본 실행
```powershell
python kospi200_daily_batch.py
```

### 배치 파일로 실행
```cmd
run_kospi200_batch.bat
```

### 옵션들
```powershell
# 테스트 실행 (실제 수집 안함)
python kospi200_daily_batch.py --dry-run

# 전체 데이터 수집 (기존 데이터 무시)
python kospi200_daily_batch.py --full

# 대기시간 조정 (30-120초)
python kospi200_daily_batch.py --min-delay 0.5 --max-delay 2.0
```

## 📊 처리 방식

1. **종목 식별**: CpCodeMgr.GetStockKospi200Kind()로 KOSPI200 종목 확인
2. **데이터 수집**: StockChart API로 일봉 OHLCV 데이터 수집
3. **저장**: historical_prices 테이블에 UPSERT 방식으로 저장
4. **대기**: 12-60초 불규칙 대기 후 다음 종목 처리

## 💡 예상 소요시간

- **KOSPI200 전체**: 약 3-7시간 (대기시간에 따라)
- **증분 업데이트**: 약 1-3시간
- **종목당 평균**: 약 1-2분 (수집 + 대기)

## 🔧 기술 사양

- **수집 방식**: 개수 요청 (최대 5,000개)
- **데이터 종류**: 일봉 OHLCV + 거래대금
- **저장 형식**: SQLite (historical_prices 테이블)
- **에러 처리**: 종목별 독립적 처리

## 📋 로그 예시

```
🚀 KOSPI200 일봉 히스토리 배치 시작
============================================================
시작 시간: 2025-01-15 09:00:00
대기 시간: 12~60초

🔍 KOSPI200 종목 목록 조회 중...
   📊 KOSPI 전체 종목 수: 945개
   ✅ KOSPI200 종목 발견: 005930 (삼성전자)
   ✅ KOSPI200 종목 발견: 000660 (SK하이닉스)
   ...

🎯 KOSPI200 종목 총 200개 발견

📊 배치 계획:
   대상 종목: 200개
   평균 대기 시간: 36초
   예상 소요 시간: 2.0시간
   예상 완료 시간: 2025-01-15 11:00:00

🔄 [1/200] 005930 (삼성전자) 처리 중...
   📊 005930 (삼성전자) 일봉 데이터 수집 중... (최대 5000개)
   ✅ 005930 (삼성전자): 4,521개 레코드 저장 완료
   📊 진행률: 0.5% | 성공률: 100.0% | 처리시간: 3.2초
   🎯 다음 종목: 000660 (SK하이닉스)
   ⏳ 45초 대기 중...
```

## ⚠️ 주의사항

1. **Cybos Plus 로그인 필수**: 실행 전 반드시 로그인 상태 확인
2. **장시간 실행**: 전체 작업 시 3-7시간 소요될 수 있음
3. **안정적인 연결**: 네트워크 연결 상태 양호해야 함
4. **키보드 중단**: Ctrl+C로 안전하게 중단 가능

## 📈 성능 최적화

- **배치 크기**: 종목별 개별 처리로 안정성 확보
- **대기시간**: 불규칙한 12-60초로 서버 부하 분산
- **증분 업데이트**: 기존 데이터 있으면 최근 100개만 수집
- **에러 복구**: 개별 종목 실패해도 전체 작업 계속
