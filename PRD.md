네, 알겠습니다. 방금 생성한 PRD(제품 요구사항 문서)를 한국어 버전으로 번역하고, 원본 파일(`price.py`, `stock.py`, `README.md`)의 내용을 참조한 부분에 정확한 출처를 표기하여 다시 작성해 드리겠습니다.

-----

```markdown
# PRD.md (Korean Ver.)
# 제품 요구사항 문서: Cybos Plus 실시간 증권 데이터 서버

**버전:** 1.0
**날짜:** 2025-08-07
**상태:** 기준안
**작성자:** Gemini AI (프로젝트 문서 기반 생성)
**소유자:** 프로젝트 이해관계자

---

## 1. 소개 및 목적

이 문서는 **Cybos Plus 실시간 증권 데이터 서버**의 제품 요구사항을 기술합니다.

이 프로젝트의 주요 목적은 대신증권 Cybos Plus API에서 실시간 국내 주식 시세 데이터를 수집하는 고성용, 안정적, 확장 가능한 서버를 구축하는 것입니다. 서버는 수집한 데이터를 로컬 SQLite 데이터베이스에 저장하고, 다른 서비스에서 사용할 수 있도록 RESTful API를 통해 제공합니다. 특히 원격 우분투 서버로 데이터를 중계하는 사용 사례를 포함합니다.

이 시스템은 **"울트라씽크 아키텍처(Ultrathink Architecture)"** 철학에 따라 설계되었으며, 극단적 모듈화(파일당 최대 300라인), 명확하게 정의된 계층형 아키텍처, 그리고 높은 응집도와 낮은 결합도 원칙을 강조합니다.

---

## 2. 목표 및 비즈니스 목적

### 2.1. 사용자 목표

* **데이터 분석가/퀀트:** 분석, 백테스팅, 전략 개발을 위해 실시간 및 과거 틱 데이터를 안정적으로 프로그래밍 방식으로 접근하고자 합니다.
* **시스템 통합 담당자:** 안정적인 한국 주식 시장 데이터 스트림을 더 큰 금융 애플리케이션 생태계에 쉽게 통합하고자 합니다.
* **개발자:** 향후 확장이나 수정을 위해 잘 구조화되고 유지보수하기 쉬우며 디버깅이 용이한 코드베이스에서 작업하고자 합니다.

### 2.2. 비즈니스 목표

* **데이터 기반 전략 지원:** 자동매매 또는 시장 분석 시스템을 개발하고 운영하는 데 필요한 기초 데이터 인프라를 제공합니다.
* **데이터 수집 분리:** Windows에 종속적인 Cybos Plus 데이터 수집 로직을 플랫폼에 독립적인 데이터 분석 및 애플리케이션 로직(예: 리눅스 서버에서 실행되는 서비스)과 분리합니다.
* **데이터 무결성 보장:** 장중 시간 동안 높은 수준의 데이터 품질과 가용성을 보장합니다.
* **낮은 운영 비용 유지:** 경량 파일 기반 데이터베이스(SQLite) 및 효율적인 아키텍처를 활용하여 리소스 소비를 최소화합니다.

---

## 3. 범위 및 기능

### 3.1. 범위 내 기능

#### 3.1.1. 핵심 데이터 수집
* **실시간 시세 피드:** Cybos Plus에서 실시간 주식 시세 업데이트를 구독하고 처리합니다.
* **주식 마스터 정보:** 메타데이터를 포함한 모든 상장 증권의 종합 목록을 가져오고 유지합니다.
* **Cybos Plus 연결 관리:** 연결 상태 확인 및 유효성 검증을 포함하여 Cybos Plus COM 객체와의 연결 생명주기를 관리합니다.

#### 3.1.2. 데이터 영속성 계층 (SQLite)
* **주식 정보 저장 (`stocks` 테이블):**
    * 각 주식에 대한 상세 정보를 저장합니다.
    * 필수 필드: 종목 코드, 종목명, 시장 구분(KOSPI/KOSDAQ), 부 구분, 감리/관리 구분, 주식 상태, 기준가, 상한가, 하한가 및 `database/models/stock.py`에 정의된 기타 메타데이터.
* **시세 정보 저장 (`prices` 테이블):**
    * 구독된 모든 주식의 시계열 시세 데이터를 저장합니다.
    * 필수 필드: 종목 코드, 시간, 현재가, OHLC, 거래량, 거래대금, 호가 정보 및 `database/models/price.py`에 정의된 기타 필드.
* **데이터베이스 초기화 및 인덱싱:** 데이터베이스 스키마를 초기화하고 성능에 필요한 인덱스를 생성하는 스크립트를 제공합니다.
* **데이터 수명 주기 관리:** 지정된 기간(예: 30일)보다 오래된 시세 데이터를 자동으로 정리하는 기능을 포함합니다.

#### 3.1.3. API 계층 (FastAPI)
* **주식 정보 엔드포인트:**
    * `GET /api/stocks`: 전체 주식 목록을 조회합니다.
    * `GET /api/stocks/{code}`: 특정 주식의 상세 정보를 조회합니다.
    * `POST /api/stocks/sync`: Cybos Plus에서 주식 마스터 데이터의 수동 동기화를 트리거합니다.
* **시세 정보 엔드포인트:**
    * `GET /api/prices/{code}`: 특정 주식의 최신 시세 정보를 조회합니다.
* **시스템 및 헬스 체크 엔드포인트:**
    * `GET /api/health`: API 서버가 실행 중인지 확인하는 간단한 엔드포인트입니다.
    * `GET /api/status`: 시스템의 운영 상태를 제공합니다.

#### 3.1.4. 원격 데이터 전송
* **데이터 전달:** 시스템은 수집된 데이터를 원격 서버로 전송할 수 있어야 합니다.
* **지원 프로토콜:** 아키텍처는 REST 및 WebSocket을 통한 데이터 전송을 지원해야 합니다.

### 3.2. 범위 외 (비-목표)
* **주문 실행:** 이 서버는 데이터 수집 및 배포 전용입니다. 매매 주문을 생성, 수정 또는 취소하지 않습니다.
* **사용자 인터페이스(UI):** 이 서버를 위한 그래픽 사용자 인터페이스는 개발되지 않습니다. 상호작용은 오직 API와 관리 스크립트를 통해서만 이루어집니다.
* **다중 플랫폼 데이터 수집:** 핵심 데이터 수집 모듈은 근본적으로 Windows/pywin32 환경에 종속되어 있으며 다른 운영체제로 이식되지 않을 것입니다.
* **고급 과거 데이터 API:** 시간 기반 조회가 일부 존재하지만, 복잡한 집계나 시계열 바 생성과 같은 포괄적인 과거 데이터 조회 엔진은 이번 버전의 주요 목표가 아닙니다.
* **사용자 인증/권한 부여:** 초기 버전은 신뢰할 수 있는 네트워크에서 운영됩니다. 복잡한 사용자 관리 및 보안은 포함되지 않습니다.

---

## 4. 사용자 및 페르소나

* **관리자 (개발자):** 서버 운영, 상태 모니터링 및 기능 확장을 담당하는 소프트웨어 개발자입니다. Python, API 및 프로젝트 아키텍처에 익숙합니다.
* **소비자 (원격 서비스):** 별도의 머신(예: 리눅스 서버)에서 실행되는 자동화된 프로세스로, REST API 또는 WebSocket을 통해 데이터를 소비하여 분석, 다른 데이터베이스에 저장 또는 기타 애플리케이션 로직을 수행합니다.

---

## 5. 기능 및 비기능 요구사항

### 5.1. 기능 요구사항

| ID | 요구사항 설명 | 우선순위 |
|---|---|---|
| FR-01 | 시스템은 초기화 시 Cybos Plus COM 객체에 **반드시** 연결해야 합니다. | Must-have |
| FR-02 | 시스템은 KOSPI 및 KOSDAQ 주식의 전체 목록을 **반드시** 가져와 저장해야 합니다. | Must-have |
| FR-03 | 시스템은 설정된 주식 목록에 대한 실시간 시세 업데이트를 **반드시** 구독해야 합니다. | Must-have |
| FR-04 | 시스템은 수신되는 실시간 데이터를 파싱하여 `PriceInfo` 데이터 모델에 **반드시** 매핑해야 합니다. | Must-have |
| FR-05 | 시스템은 수신된 모든 실시간 틱을 `prices` SQLite 테이블에 **반드시** 저장해야 합니다. | Must-have |
| FR-06 | API는 주어진 종목 코드에 대한 마지막 시세를 조회하는 엔드포인트를 **반드시** 제공해야 합니다. | Must-have |
| FR-07 | 시스템은 필요한 테이블과 인덱스로 SQLite 데이터베이스를 초기화하는 스크립트를 **반드시** 제공해야 합니다. | Must-have |
| FR-08 | 시스템은 KOSPI200 구성 종목을 가져오는 메커니즘을 **제공해야 합니다 (Should-have)**. | Should-have |
| FR-09 | 시스템은 Cybos Plus API 호출 제한(예: 분당 200회)을 준수하기 위해 요청 제한 장치를 **구현해야 합니다 (Should-have)**. | Should-have |
| FR-10 | API는 특정 시간 범위 내의 시세 데이터를 조회하는 엔드포인트를 **제공할 수 있습니다 (Could-have)**. | Could-have |
| FR-11 | 시스템은 데이터베이스가 무한정 커지는 것을 방지하기 위해 데이터 정리 메커니즘을 **반드시** 포함해야 합니다. | Must-have |

### 5.2. 비기능 요구사항 (제약 조건 및 품질 속성)

| ID | 요구사항 설명 | 제약 조건 |
|---|---|---|
| NFR-01 | **플랫폼 종속성:** 데이터 수집 서비스는 **반드시** Windows 32비트 환경의 Python 3.9 및 pywin32에서 실행되어야 합니다. | **시스템 제약** |
| NFR-02 | **필수 선행 소프트웨어:** 시스템이 작동하려면 대신증권 Cybos Plus HTS가 **반드시** 설치 및 로그인되어 있어야 합니다. | **외부 의존성** |
| NFR-03 | **모듈성:** 모든 Python 소스 파일은 **반드시** 300라인을 초과해서는 안 됩니다. | **아키텍처 제약** |
| NFR-04 | **성능:** 시스템은 최대 시장 활동 중에도 데이터 손실 없이 최소한의 지연 시간으로 들어오는 틱 데이터를 처리하고 저장해야 합니다. | **성능** |
| NFR-05 | **안정성:** 서버는 장중 시간 동안 충돌이나 메모리 누수 없이 지속적으로 실행되어야 합니다. 연결 오류를 정상적으로 처리하고 재연결을 시도해야 합니다. | **신뢰성** |
| NFR-06 | **유지보수성:** 코드는 타입 힌트로 잘 문서화되어야 하며, 쉬운 업데이트와 버그 수정을 위해 정의된 계층형 아키텍처를 따라야 합니다. | **유지보수성** |
| NFR-07 | **구성 가능성:** 주요 파라미터(데이터베이스 경로, API 포트, 로그 레벨, 원격 서버 URL)는 **반드시** 환경 변수나 설정 파일을 통해 구성할 수 있어야 합니다. | **사용성** |

---

## 6. 데이터 모델 및 스키마

데이터는 `StockInfo`와 `PriceInfo` 두 가지 주요 모델로 구조화됩니다.

### 6.1. StockInfo 데이터 모델
금융 상품에 대한 정적 정보를 나타냅니다.
* **소스:** `database/models/stock.py`
* **주요 속성:** `code` (기본 키), `name`, `market_kind`, `section_kind`, `control_kind`, `supervision_kind`, `stock_status_kind`, `std_price`, `max_price`, `min_price`.
* **데이터베이스 테이블:** `stocks`

### 6.2. PriceInfo 데이터 모델
특정 순간의 주식 가격 및 거래량 정보 스냅샷을 나타냅니다.
* **소스:** `database/models/price.py`
* **주요 속성:** `code`, `name`, `time`, `current_price`, `change`, `change_rate`, `status`, `open_price`, `high_price`, `low_price`, `volume`, `amount`, `ask_price`, `bid_price`.
* **데이터베이스 테이블:** `prices`

---

## 7. 가정 및 의존성

* **Cybos Plus API 안정성:** Cybos Plus API가 장중 시간 동안 안정적이며 정확한 데이터를 제공한다고 가정합니다.
* **네트워크 연결성:** 서버, Cybos Plus 및 모든 원격 데이터 소비자 간의 안정적인 네트워크 연결을 가정합니다.
* **Windows 환경:** 호스트 머신이 32비트 Windows 환경으로 올바르게 구성되어 있다고 가정합니다.
* **단일 스레드 COM 접근:** 동시성 문제를 방지하기 위해 Cybos Plus COM 객체와의 상호작용이 단일 스레드 특성을 존중하는 방식으로 처리된다고 가정합니다.

---

## 8. 미결정 질문

* 초기 시작 시 구독할 주식의 최종 목록은 무엇입니까? 전체, KOSPI200, 또는 사용자 정의 목록?
* 필요한 데이터 보존 정책은 무엇입니까 (현재 기본값은 30일)?
* 원격 우분투 서버 엔드포인트에 대한 구체적인 인증 요구사항은 무엇입니까? (예: API 키 헤더 이름)
* 원격 서버에 연결할 수 없는 경우 예상되는 오류 처리 동작은 무엇입니까? (예: 재시도 큐, 데이터 폐기)
```